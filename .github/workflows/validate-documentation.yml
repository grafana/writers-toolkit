name: Documentation CI

permissions: {}

on:
  pull_request:
  workflow_dispatch:

jobs:
  changed-files:
    runs-on: ubuntu-latest
    outputs:
      any_changed: ${{ steps.changed-files.outputs.any_changed }}
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1
      - uses: step-security/changed-files@95b56dadb92a30ca9036f16423fd3c088a71ee94 # v46.0.5
        id: changed-files
        with:
          files: |
            docs/sources/**
            vale/**

  ci:
    needs: changed-files
    if: needs.changed-files.outputs.any_changed == 'true'
    permissions:
      contents: read
      checks: write
      pull-requests: write
      security-events: write
    uses: ./.github/workflows/docs-ci.yml
    with:
      build: true
      build-website-directory: content/docs/writers-toolkit
      prettier: true
      vale: true
      readability: true

  result:
    runs-on: ubuntu-latest
    needs: [changed-files, ci]
    if: always()
    steps:
      - name: Determine result
        run: |
          if [[ "${{ needs.changed-files.outputs.any_changed }}" == "false" ]]; then
            echo "No documentation files changed, skipping CI"
            exit 0
          elif [[ "${{ needs.ci.result }}" == "success" ]]; then
            echo "CI passed"
            exit 0
          else
            echo "CI failed or was cancelled"
            exit 1
          fi
